webpackJsonp([20],{EuWY:function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var o=i("Dd8w"),n=i.n(o),a={name:"service-port",data:function(){var t=this;return{loadingSave:!1,viewInfo:!1,modalTitle:"添加",pageNo:1,loading:!0,totalCount:0,pageSize:10,columns:[{title:"网点名称",key:"name",align:"center"},{title:"备用网点",key:"isSlave",align:"center"},{title:"网点地址",key:"address",align:"center"},{title:"联系电话",key:"phone",align:"center"},{title:"服务区域数量",key:"regionNum",align:"center"},{title:"操作",align:"center",render:function(e,i){var o=t;return e("div",[e("Button",{props:{type:"primary",size:"small"},style:{marginRight:"8px"},on:{click:function(){var t=i.row.id;o.viewInfo=!0,o.modalTitle="查看",o.getStation(t),o.getStationInfo(t)}}},"查看"),e("Button",{props:{type:"success",size:"small"},on:{click:function(){var t=i.row.id;o.viewInfo=!1,o.modalTitle="编辑",o.getStation(t),o.getStationInfo(t)}}},"编辑")])}}],portLists:[],portSetting:!1,portSettingForm:{name:"",address:"",phone:"",isSlave:!1,regionList:[],loginName:"",password:""},stationLists:[],portSettingRule:{name:[{required:!0,message:"请输入网点名称",trigger:"blur"}],address:[{required:!0,message:"请输入网点地址",trigger:"blur"}],phone:[{required:!0,message:"请输入网点电话",trigger:"blur"},{validator:function(t,e,i){""===e?i(new Error("请输入联系电话")):""!==e&&(/^1[3456789]\d{9}/.test(e)||/0\d{2,3}-\d{7,8}/.test(e)?i():i(new Error("请输入正确格式的电话")))},trigger:"blur"}],loginName:[{required:!0,message:"管理员账号",trigger:"blur"}],password:[{required:!0,message:"管理员密码",trigger:"blur"},{validator:function(t,e,i){e.length<6?i(new Error("密码至少6位")):e.length>10?i(new Error("密码最多10位")):i()},trigger:"blur"}]}}},methods:{toggleSlave:function(t){t&&(this.portSettingForm.regionList=[])},getLists:function(){var t=this,e="pageNo="+this.pageNo+"&pageSize="+this.pageSize;this.$http.get("/repair/station/list?"+e).then(function(e){var i=e.data;0===i.code&&(t.loading=!1,t.portLists=i.data.list,t.pageSize=i.data.pageSize,t.totalCount=i.data.totalCount)})},pageToggle:function(t){console.log(t),this.pageNo=t,this.getLists()},pageSizeToggle:function(t){this.pageSize=t,this.getLists()},getStation:function(t){var e=this;this.$http.get("/repair/station/region/list?id="+t).then(function(t){if(0===t.data.code){var i=t.data.data;e.stationLists=i}})},saveStation:function(t){var e=this;this.loadingSave=!0;var i=this.portSettingForm,o={name:i.name,address:i.address,phone:i.phone,isSlave:i.isSlave?"Y":"N",stationAdmin:{loginName:i.loginName},regionList:i.regionList},a="";i.id?(a="/repair/station/edit",o.id=i.id,o.stationAdmin.id=i.stationId,"000000"!==i.password&&(o.stationAdmin.password=i.password)):(a="/repair/station/add",o.stationAdmin.password=i.password),this.$refs[t].validate(function(t){t?e.$http.post(a,n()({},o)).then(function(t){e.loadingSave=!1,0===t.data.code?(e.$Message.success("保存成功"),e.init(),e.getLists()):e.$Message.error("保存失败,"+t.data.msg),e.portSetting=!1}):e.loadingSave=!1})},init:function(){this.pageNo=1,this.hasNextPage=!0},validateInputTel:function(t){var e=t.key;if(!/(\d|\-)/.test(e)&&"Backspace"!==e)return t.preventDefault(),!1},getStationInfo:function(t){var e=this;this.$http.get("/repair/station/info?id="+t).then(function(t){if(0===t.data.code){var i=t.data.data;e.portSettingForm={name:i.name,address:i.address,phone:i.phone,isSlave:"Y"===i.isSlave,regionList:i.regionList,loginName:i.stationAdmin?i.stationAdmin.loginName:"",password:i.stationAdmin?"000000":"",stationId:i.stationAdmin?i.stationAdmin.id:"",id:i.id},e.portSetting=!0}})},newStation:function(){this.portSettingForm={name:"",address:"",phone:"",isSlave:!1,regionList:[],loginName:"",password:""},this.getStation(),this.modalTitle="添加",this.viewInfo=!1,this.portSetting=!0},modalHide:function(t){t||this.$refs.portSet.resetFields()}},mounted:function(){this.getLists(),this.getStation()},watch:{}},s={render:function(){var t=this,e=t.$createElement,i=t._self._c||e;return i("div",[i("Card",[i("div",{staticClass:"clearfix mb-15"},[i("div",{staticClass:"pull-left"},[i("Button",{attrs:{type:"primary"},on:{click:t.newStation}},[t._v("新建")])],1)]),t._v(" "),i("div",{staticClass:"table-wrapper"},[i("Table",{attrs:{loading:t.loading,data:t.portLists,columns:t.columns}}),t._v(" "),i("div",{staticClass:"pagination"},[i("Page",{attrs:{"page-size":t.pageSize,total:t.totalCount,"show-sizer":"","show-elevator":""},on:{"on-change":t.pageToggle,"on-page-size-change":t.pageSizeToggle}})],1)],1)]),t._v(" "),i("Modal",{attrs:{"mask-closable":!1,title:t.modalTitle+"服务网点"},on:{"on-visible-change":t.modalHide},model:{value:t.portSetting,callback:function(e){t.portSetting=e},expression:"portSetting"}},[i("Form",{ref:"portSet",attrs:{model:t.portSettingForm,rules:t.portSettingRule,"label-width":120,"label-position":"right"}},[i("FormItem",{attrs:{label:"服务网点名称",prop:"name"}},[i("Input",{staticClass:"form-input",attrs:{disabled:t.viewInfo},model:{value:t.portSettingForm.name,callback:function(e){t.$set(t.portSettingForm,"name",e)},expression:"portSettingForm.name"}})],1),t._v(" "),i("FormItem",{attrs:{label:"服务网点地址",prop:"address"}},[i("Input",{staticClass:"form-input",attrs:{disabled:t.viewInfo},model:{value:t.portSettingForm.address,callback:function(e){t.$set(t.portSettingForm,"address",e)},expression:"portSettingForm.address"}})],1),t._v(" "),i("FormItem",{attrs:{label:"服务网点电话",prop:"phone"}},[i("Input",{staticClass:"form-input",attrs:{disabled:t.viewInfo,placeholder:"请输入手机或座机号"},on:{"on-keydown":t.validateInputTel},model:{value:t.portSettingForm.phone,callback:function(e){t.$set(t.portSettingForm,"phone",e)},expression:"portSettingForm.phone"}})],1),t._v(" "),i("FormItem",{attrs:{label:"服务区域设置",prop:"regionList"}},[i("CheckboxGroup",{model:{value:t.portSettingForm.regionList,callback:function(e){t.$set(t.portSettingForm,"regionList",e)},expression:"portSettingForm.regionList"}},[i("ul",{staticClass:"column_3"},t._l(t.stationLists,function(e){return i("li",[i("Checkbox",{attrs:{disabled:t.viewInfo||t.portSettingForm.isSlave,label:e.id}},[t._v(t._s(e.name))])],1)}))])],1),t._v(" "),i("FormItem",{attrs:{label:"管理员账号",prop:"loginName"}},[i("Input",{staticClass:"form-input",attrs:{disabled:t.viewInfo},model:{value:t.portSettingForm.loginName,callback:function(e){t.$set(t.portSettingForm,"loginName",e)},expression:"portSettingForm.loginName"}})],1),t._v(" "),i("FormItem",{attrs:{label:"登陆密码",prop:"password"}},[i("Input",{staticClass:"form-input",attrs:{disabled:t.viewInfo,type:"password",placeholder:"请设置6~10位密码"},model:{value:t.portSettingForm.password,callback:function(e){t.$set(t.portSettingForm,"password",e)},expression:"portSettingForm.password"}})],1),t._v(" "),i("FormItem",{attrs:{label:"备用网点"}},[i("i-switch",{attrs:{disabled:t.viewInfo},on:{"on-change":t.toggleSlave},model:{value:t.portSettingForm.isSlave,callback:function(e){t.$set(t.portSettingForm,"isSlave",e)},expression:"portSettingForm.isSlave"}},[i("span",{attrs:{slot:"open"},slot:"open"},[t._v("是")]),t._v(" "),i("span",{attrs:{slot:"close"},slot:"close"},[t._v("否")])])],1)],1),t._v(" "),i("div",{attrs:{slot:"footer"},slot:"footer"},[i("div",{staticClass:"inner-center"},[t.viewInfo?[i("Button",{attrs:{type:"primary"},on:{click:function(e){t.viewInfo=!1}}},[t._v("编辑")]),t._v(" "),i("Button",{on:{click:function(e){t.portSetting=!1}}},[t._v("返回")])]:[i("Button",{on:{click:function(e){t.portSetting=!1}}},[t._v("取消")]),t._v(" "),i("Button",{attrs:{loading:t.loadingSave,type:"primary"},on:{click:function(e){t.saveStation("portSet")}}},[t._v("确认")])]],2)])],1)],1)},staticRenderFns:[]};var r=i("VU/8")(a,s,!1,function(t){i("SlyL")},"data-v-b67c8f2a",null);e.default=r.exports},SlyL:function(t,e){}});