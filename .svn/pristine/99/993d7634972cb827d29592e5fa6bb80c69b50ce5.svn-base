webpackJsonp([26],{"Gwl/":function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var a=i("Dd8w"),r=i.n(a),n=i("TVG1"),o={name:"finance-view",data:function(){var e=this;return{viewType:"month",filter:!1,repairColumns:[{title:"报修类型",key:"name",align:"center"},{title:"已付工单总数",key:"orderNum",align:"center"},{title:"已付工单收入",key:"orderAmount",align:"center"},{title:"员工结算",key:"employeeCommission",align:"center"},{title:"平台佣金",key:"platformCommission",align:"center"},{title:"服务收益",key:"serviceEarning",align:"center"}],detailColumn:[{title:"创建日期",key:"createTime",align:"center",width:140},{title:"付款时间",key:"payTime",align:"center",width:140},{title:"工单单号",key:"orderSn",align:"center",minWidth:160},{title:"支付方式",key:"payType",align:"center",width:100},{title:"交易号",key:"paySn",align:"center",width:140},{title:"报修类型",key:"repairCategoryName",align:"center",width:100},{title:"服务网点",key:"stationName",align:"center",width:100},{title:"工单状态",key:"orderState",align:"center",width:100},{title:"工单金额",key:"orderAmount",align:"center",width:100},{title:"师傅姓名",key:"serverName",align:"center",width:100},{title:"师傅提成",key:"employeeCommission",align:"center",width:100},{title:"平台佣金比",key:"platformCommissionRate",align:"center",width:100},{title:"平台佣金",key:"platformCommission",align:"center",width:100},{title:"操作",fixed:"right",width:100,align:"center",render:function(t,i){var a=e;return t("Button",{props:{type:"text"},on:{click:function(){var e=i.row.id;a.$router.push({name:"orderDetail",params:{id:e}})}}},"查看订单")}}],repairLists:[],stationLists:[],detailLists:[],earningCount:{},categoryEarningCountList:[],detailPageTotal:0,detailPageSize:10,detailPageNo:1,filterForm:{repairCategoryId:"",serverName:"",stationId:"",dateRange:[]}}},methods:{getOrderLists:function(e){var t=this,i="pageNo="+this.detailPageNo+"&pageSize="+this.detailPageSize,a={timeType:1};"month"===this.viewType?a.timeScope=1:"three"===this.viewType&&(a.timeScope=2),e&&(a=r()({},e),e.startDate&&e.endDate&&(a.timeType=2,a.timeScope=""));var o=n.a.formatterParams(a);this.$http.post("/order/earning/list?"+i+"&"+o).then(function(e){if(0===e.data.code){var i=e.data.data;t.detailLists=i.list,t.detailPageTotal=i.totalCount,t.detailPageSize=i.pageSize,t.filter=!1}})},getOrderTotal:function(e){var t=this,i={timeType:1};"month"===this.viewType?i.timeScope=1:"three"===this.viewType&&(i.timeScope=2),e&&(i=r()({},e),e.startDate&&e.endDate&&(i.timeType=2,delete i.timeScope));var a=n.a.formatterParams(i);this.$http.post("/order/earning/count?"+a).then(function(i){if(0===i.data.code){var a=i.data.data;t.earningCount=a.earningCount,t.categoryEarningCountList=a.categoryEarningCountList,t.filter=!1,e&&e.startDate&&(t.viewType="")}else console.log("财务统计信息失败："+i.data.msg)})},clearFilter:function(e){this.$refs[e].resetFields(),this.filter=!1,this.getOrderLists(),this.getOrderTotal()},sureFilter:function(){var e=r()({},this.filterForm);e.dateRange&&delete e.dateRange,this.getOrderLists(e),this.getOrderTotal(e)},pageChange:function(e){this.pageNo=e,this.getOrderLists()},pageSizeChange:function(e){this.pageSize=e,this.getOrderLists()},filterDateChange:function(e){this.filterForm.startDate=e[0],this.filterForm.endDate=e[1]},exportExcel:function(){var e=r()({},this.filterForm),t={timeType:1};for(var i in"month"===this.viewType?t.timeScope=1:"three"===this.viewType&&(t.timeScope=2),e)(e[i].length>0||e[i]>0)&&(t[i]=e[i]),t.startDate&&t.endDate&&(t.timeType=2,delete t.timeScope,delete t.dateRange);var a=n.a.formatterParams(t);this.$http.post("/order/earning/export?"+a,null,{responseType:"blob"}).then(function(e){var t=new Blob([e.data],{type:"application/vnd.openxmlformats-officedocument.spreadsheetml.sheet;charset=utf-8"}),i=document.createElement("a"),a=window.URL.createObjectURL(t);i.href=a,i.download="财务概览列表.xlsx",document.body.appendChild(i),i.click(),document.body.removeChild(i),window.URL.revokeObjectURL(a)})}},mounted:function(){var e=this;this.getOrderLists(),this.getOrderTotal(),n.a.getRepairType(function(t){e.repairLists=t}),n.a.getStationLists(function(t){e.stationLists=t})},watch:{viewType:function(e){e&&(this.getOrderLists(),this.getOrderTotal())}}},l={render:function(){var e=this,t=e.$createElement,i=e._self._c||t;return i("div",[i("Card",{staticClass:"mb-15"},[i("div",{staticClass:"clearfix mb-15"},[i("div",{staticClass:"pull-left"},[i("Button",{attrs:{type:"month"===e.viewType?"primary":"default"},on:{click:function(t){e.viewType="month"}}},[e._v("本月")]),e._v(" "),i("Button",{attrs:{type:"three"===e.viewType?"primary":"default"},on:{click:function(t){e.viewType="three"}}},[e._v("前三月")]),e._v(" "),i("Button",{on:{click:function(t){e.filter=!0}}},[e._v("筛选")])],1),e._v(" "),i("div",{staticClass:"pull-right"},[i("Button",{attrs:{type:"primary"},on:{click:e.exportExcel}},[e._v("excel导出")])],1)]),e._v(" "),i("div",[i("div",{staticClass:"table-wrapper mb-15"},[i("table",{staticClass:"native-table"},[i("thead",[i("tr",[i("th",[e._v("项目名称")]),e._v(" "),i("th",[e._v("已付工单总数")]),e._v(" "),i("th",[e._v("已付工单收入")]),e._v(" "),i("th",[e._v("员工结算")]),e._v(" "),i("th",[e._v("平台佣金")]),e._v(" "),i("th",[e._v("服务收益")])])]),e._v(" "),i("tbody",[i("tr",[i("td",[e._v(e._s(e.earningCount.name))]),e._v(" "),i("td",[e._v(e._s(e.earningCount.orderNum))]),e._v(" "),i("td",[e._v(e._s(e.earningCount.orderAmount))]),e._v(" "),i("td",[e._v(e._s(e.earningCount.employeeCommission))]),e._v(" "),i("td",[e._v(e._s(e.earningCount.platformCommission))]),e._v(" "),i("td",[e._v(e._s(e.earningCount.serviceEarning))])])])])]),e._v(" "),i("div",{staticClass:"table-wrapper mb-15"},[i("Table",{attrs:{columns:e.repairColumns,data:e.categoryEarningCountList}})],1)])]),e._v(" "),i("Card",[i("p",{attrs:{slot:"title"},slot:"title"},[e._v("明细")]),e._v(" "),i("div",{staticClass:"table-wrapper"},[i("Table",{attrs:{columns:e.detailColumn,data:e.detailLists}}),e._v(" "),i("div",{staticClass:"pagination"},[i("Page",{attrs:{total:e.detailPageTotal,"show-sizer":"","show-elevator":""},on:{"on-change":e.pageChange,"on-page-size-change":e.pageSizeChange}})],1)],1)]),e._v(" "),i("Drawer",{attrs:{title:"工单筛选",width:"450"},model:{value:e.filter,callback:function(t){e.filter=t},expression:"filter"}},[i("div",{staticClass:"clearfix mb-15"},[i("div",{staticClass:"pull-left"},[i("Button",{on:{click:function(t){e.clearFilter("filterForm")}}},[e._v("清空筛选条件")])],1),e._v(" "),i("div",{staticClass:"pull-right"},[i("Button",{attrs:{type:"primary"},on:{click:e.sureFilter}},[e._v("确定")])],1)]),e._v(" "),i("Form",{ref:"filterForm",attrs:{model:e.filterForm,"label-position":"top"}},[i("FormItem",{attrs:{label:"报修类型",prop:"repairCategoryId"}},[i("Select",{model:{value:e.filterForm.repairCategoryId,callback:function(t){e.$set(e.filterForm,"repairCategoryId",t)},expression:"filterForm.repairCategoryId"}},e._l(e.repairLists,function(t){return i("Option",{key:t.id,attrs:{value:t.id}},[e._v(e._s(t.name))])}))],1),e._v(" "),i("FormItem",{attrs:{label:"服务人员",prop:"serverName"}},[i("Input",{model:{value:e.filterForm.serverName,callback:function(t){e.$set(e.filterForm,"serverName",t)},expression:"filterForm.serverName"}})],1),e._v(" "),i("FormItem",{attrs:{label:"服务网点",prop:"stationId"}},[i("Select",{model:{value:e.filterForm.stationId,callback:function(t){e.$set(e.filterForm,"stationId",t)},expression:"filterForm.stationId"}},e._l(e.stationLists,function(t){return i("Option",{key:t.id,attrs:{value:t.id}},[e._v(e._s(t.name))])}))],1),e._v(" "),i("FormItem",{attrs:{label:"付款时间",prop:"dateRange"}},[i("DatePicker",{staticStyle:{width:"100%"},attrs:{type:"daterange"},on:{"on-change":e.filterDateChange},model:{value:e.filterForm.dateRange,callback:function(t){e.$set(e.filterForm,"dateRange",t)},expression:"filterForm.dateRange"}})],1)],1)],1)],1)},staticRenderFns:[]};var s=i("VU/8")(o,l,!1,function(e){i("i9LF")},"data-v-76eedc84",null);t.default=s.exports},i9LF:function(e,t){}});
//# sourceMappingURL=26.efeb14576e6d1b68dd70.js.map