webpackJsonp([46],{PEkJ:function(e,t){},Z9MP:function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=r("Dd8w"),a=r.n(i),o=r("TVG1"),s={name:"repair-type",computed:{uploadUrl:function(){return this.$http.defaults.baseURL+"/repair/category/import"}},data:function(){var e=this;return{loadingSend:!1,uploadingModal:!1,uploadPercent:0,hasFee:!1,modalTitle:"新建",repairModal:!1,filter:!1,tableColumn:[{title:"名称",key:"name",align:"center"},{title:"上门费",align:"center",render:function(e,t){return"Y"===t.row.hasDtdServiceFee?e("span",t.row.dtdServiceFee):e("span","无")}},{title:"职工结算标准",align:"center",render:function(e,t){return e("span",t.row.employeeDtdServiceCommission)}},{title:"操作",align:"center",render:function(t,r){var i=e;return t("div",[t("Button",{props:{type:"primary",size:"small"},style:{marginRight:"8px"},on:{click:function(){var e=r.row.id;i.getTypeInfo(e),i.modalTitle="编辑",i.repairModal=!0}}},"编辑"),t("Button",{props:{type:"error",size:"small"},className:"text-red",on:{click:function(){var e=r.row.id;i.$store.commit("setDeleteModal",{model:!0,callback:function(){i.deleteType(e)}})}}},"删除")])}}],lists:[],typeForm:{id:"",callCenterId:"",name:"",hasDtdServiceFee:"Y",dtdServiceFee:0,employeeDtdServiceCommission:0},typeFormRule:{name:[{required:!0,message:"请输入报修分类名称",trigger:"blur"}],employeeDtdServiceCommission:[{required:!0,message:"请输入员工上门费结算标准",trigger:"blur",type:"number"}],dtdServiceFee:[{required:!0,message:"请输入上门费收费标准",trigger:"blur",type:"number"}]},repairFilter:{name:"",needFee:!0}}},methods:{inputName:function(e){var t=e.key;if(/[^\a-\z\A-\Z0-9\u4E00-\u9FA5]/.test(t))return e.preventDefault(),!1},toggleFee:function(e){this.hasFee=e,e||(this.typeForm.dtdServiceFee=0)},clearFilter:function(){this.repairFilter={name:"",needFee:!0},this.getTypeLists(),this.filter=!1},filterData:function(){var e=this.repairFilter,t={name:e.name,hasDtdServiceFee:e.needFee?"Y":"N"};this.getTypeLists(t),this.filter=!1},getTypeLists:function(e){var t=this,r="";e&&(r=o.a.formatterParams(e)),this.$http.get("/repair/category/list?"+r).then(function(e){0===e.data.code?t.lists=e.data.data:t.$Message.error(e.data.msg)})},getTypeInfo:function(e){var t=this;this.$http.get("/repair/category/info?id="+e).then(function(e){0===e.data.code?(t.typeForm=e.data.data,t.typeForm.dtdServiceFee*=1,t.typeForm.employeeDtdServiceCommission*=1,t.hasFee="Y"===e.data.data.hasDtdServiceFee):console.log("单个信息获取失败："+e.data.msg)})},saveType:function(){var e=this,t=this.typeForm;t.hasDtdServiceFee=this.hasFee?"Y":"N";var r="";r=t.id.length>0?"/repair/category/edit":"/repair/category/add",this.loadingSend=!0,this.$refs.typeForm.validate(function(i){i?e.$http.post(r,a()({},t)).then(function(t){0===t.data.code?(e.$Message.success("保存成功"),e.repairModal=!1,e.getTypeLists()):e.$Message.error(t.data.msg),e.loadingSend=!1}):e.loadingSend=!1})},inputMoney:function(e,t){var r=e.key,i=this.$refs[t].value.toString();if("Backspace"!==r){if(!/(\d|\.)/.test(r))return e.preventDefault(),!1;if(i.indexOf(".")>-1&&"."===r)return e.preventDefault(),!1}},deleteType:function(e){var t=this;this.$http({url:"/repair/category/delete?id="+e,method:"delete"}).then(function(e){0===e.data.code?(t.$Message.info("删除成功"),t.$store.commit("setDeleteModal",{model:!1}),t.getTypeLists()):(t.$Message.error(e.data.msg),_this.$store.commit("setDeleteModal",{model:!1}))})},downExcel:function(){this.$http.get("/repair/category/import/template",{responseType:"blob"}).then(function(e){o.a.downloadExcel(e)})},uploadSuccess:function(e,t,r){var i=this;setTimeout(function(){0===e.code?i.$Message.success("上传成功"):i.$Message.error(e.msg),i.$store.commit("setUploadProgress",!1),i.$store.commit("setUploadPercent",100),i.getTypeLists()},1e3)},uploading:function(){this.$store.commit("setUploadProgress",!0),this.$store.commit("setUploadPercent",0)},resetForm:function(){this.typeForm={id:"",callCenterId:"",name:"",hasDtdServiceFee:"Y",dtdServiceFee:0,employeeDtdServiceCommission:0},this.$refs.typeForm.resetFields()}},mounted:function(){this.getTypeLists()}},n={render:function(){var e=this,t=e.$createElement,r=e._self._c||t;return r("div",[r("Card",[r("div",[r("div",{staticClass:"clearfix mb-15"},[r("div",{staticClass:"pull-left"},[r("Button",{attrs:{icon:"md-add"},on:{click:function(t){e.modalTitle="新建",e.repairModal=!0,e.hasFee=!1}}},[e._v("新建")]),e._v(" "),r("Button",{attrs:{icon:"ios-funnel"},on:{click:function(t){e.filter=!0}}},[e._v("筛选")])],1),e._v(" "),r("div",{staticClass:"pull-right"},[r("Button",{attrs:{icon:"ios-cloud-download-outline"},on:{click:e.downExcel}},[e._v("excel导入模板下载")]),e._v(" "),r("div",{staticClass:"inline-upload"},[r("Upload",{attrs:{action:e.uploadUrl,"with-credentials":!0,"on-success":e.uploadSuccess,"before-upload":e.uploading,"show-upload-list":!1}},[r("Button",{attrs:{icon:"ios-cloud-upload-outline"}},[e._v("excel导入")])],1)],1)],1)]),e._v(" "),r("div",{staticClass:"table-wrapper"},[r("Table",{attrs:{data:e.lists,columns:e.tableColumn}})],1)])]),e._v(" "),r("Modal",{attrs:{title:e.modalTitle+"报修分类","mask-closable":!1},on:{"on-visible-change":e.resetForm},model:{value:e.repairModal,callback:function(t){e.repairModal=t},expression:"repairModal"}},[r("div",{staticClass:"modal_wrap_form"},[r("i-form",{ref:"typeForm",attrs:{model:e.typeForm,"label-position":"top",rules:e.typeFormRule}},[r("form-item",{attrs:{label:"报修分类名称",prop:"name"}},[r("Input",{on:{"on-keydown":e.inputName},model:{value:e.typeForm.name,callback:function(t){e.$set(e.typeForm,"name",t)},expression:"typeForm.name"}})],1),e._v(" "),r("form-item",{attrs:{label:"上门费收费标准"}},[r("Row",{attrs:{gutter:15}},[r("Col",{attrs:{span:"16"}},[r("form-item",{attrs:{prop:"dtdServiceFee"}},[r("InputNumber",{staticStyle:{width:"100%"},attrs:{min:0,precision:2,disabled:!e.hasFee},model:{value:e.typeForm.dtdServiceFee,callback:function(t){e.$set(e.typeForm,"dtdServiceFee",t)},expression:"typeForm.dtdServiceFee"}})],1)],1),e._v(" "),r("Col",{attrs:{span:"8"}},[r("form-item",{attrs:{prop:"hasFee"}},[r("Checkbox",{on:{"on-change":e.toggleFee},model:{value:e.hasFee,callback:function(t){e.hasFee=t},expression:"hasFee"}},[e._v("收取上门费")])],1)],1)],1)],1),e._v(" "),r("form-item",{attrs:{label:"员工上门费结算标准",prop:"employeeDtdServiceCommission"}},[r("InputNumber",{staticStyle:{width:"100%"},attrs:{precision:2,min:0},model:{value:e.typeForm.employeeDtdServiceCommission,callback:function(t){e.$set(e.typeForm,"employeeDtdServiceCommission",t)},expression:"typeForm.employeeDtdServiceCommission"}})],1)],1)],1),e._v(" "),r("div",{attrs:{slot:"footer"},slot:"footer"},[r("Button",{on:{click:function(t){e.repairModal=!1}}},[e._v("取消")]),e._v(" "),r("Button",{attrs:{loading:e.loadingSend,type:"primary"},on:{click:e.saveType}},[e._v(e._s(1===e.modalTitle?"添加":"保存"))])],1)]),e._v(" "),r("Drawer",{attrs:{title:"报修筛选",width:"425"},model:{value:e.filter,callback:function(t){e.filter=t},expression:"filter"}},[r("div",{staticClass:"filter-top mb-15 clearfix"},[r("div",{staticClass:"pull-left"},[r("Button",{attrs:{icon:"md-close-circle"},on:{click:e.clearFilter}},[e._v("清空筛选条件")])],1),e._v(" "),r("div",{staticClass:"pull-right"},[r("Button",{attrs:{type:"primary"},on:{click:e.filterData}},[e._v("确定筛选")])],1)]),e._v(" "),r("i-form",{model:{value:e.repairFilter,callback:function(t){e.repairFilter=t},expression:"repairFilter"}},[r("form-item",{attrs:{label:"报修名称"}},[r("Input",{model:{value:e.repairFilter.name,callback:function(t){e.$set(e.repairFilter,"name",t)},expression:"repairFilter.name"}})],1),e._v(" "),r("form-item",{attrs:{label:"收取上门费"}},[r("i-switch",{model:{value:e.repairFilter.needFee,callback:function(t){e.$set(e.repairFilter,"needFee",t)},expression:"repairFilter.needFee"}})],1)],1)],1)],1)},staticRenderFns:[]};var l=r("VU/8")(s,n,!1,function(e){r("PEkJ")},"data-v-11ef40ae",null);t.default=l.exports}});