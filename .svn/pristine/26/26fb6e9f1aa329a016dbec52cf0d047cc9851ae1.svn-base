webpackJsonp([11],{dAbC:function(t,e,a){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var i=a("Dd8w"),n=a.n(i),r=a("TVG1"),l={name:"materials-calc",data:function(){var t=this;return{viewType:"month",filter:!1,repairColumns:[{title:"报修类型",key:"name",align:"center"},{title:"采购数",key:"inputNum",align:"center"},{title:"采购成本",key:"inputAmount",align:"center"},{title:"退货数",key:"outputNum",align:"center"},{title:"退货成本",key:"outputAmount",align:"center"},{title:"结余",key:"earning",align:"center"}],detailColumn:[{title:"材料名称",key:"materialName",align:"center"},{title:"报修类型",key:"repairCategoryName",align:"center"},{title:"日期",key:"createTime",align:"center"},{title:"单号",key:"sn",align:"center"},{title:"单号类型",key:"changeType",align:"center"},{title:"服务网点",key:"departmentName",align:"center"},{title:"数量",key:"num",align:"center"},{title:"成本",key:"amount",align:"center"},{title:"操作",align:"center",render:function(e,a){return e("Button",{props:{type:"text",size:"small"},on:{click:function(){var e=a.row.id,i=a.row.type;"INPUT"===i?t.$router.push({name:"inDetail",params:{id:e}}):"OUTPUT"===i&&t.$router.push({name:"outDetail",params:{id:e}})}}},"查看订单")}}],repairLists:[],stationLists:[],detailLists:[],earningCount:{},categoryEarningCountList:[],pageNo:1,pageSize:10,totalCount:0,filterForm:{repairCategoryId:"",departmentId:"",dateRange:[],materialName:""}}},methods:{getTotal:function(t){var e=this,a={timeType:1};"month"===this.viewType?a.timeScope=1:"three"===this.viewType&&(a.timeScope=2),t&&(a=n()({},t),t.startDate&&t.endDate&&(a.timeType=2,delete a.timeScope)),this.$http.post("/material/earning/count",n()({},a)).then(function(a){if(0===a.data.code){var i=a.data.data;e.earningCount=i.earningCount,e.categoryEarningCountList=i.categoryEarningCountList,t&&t.startDate&&(e.viewType="")}else console.log("辅材核算统计失败："+a.data.msg)})},getDetailLists:function(t){var e=this,a="pageSize="+this.pageSize+"&pageNo="+this.pageNo,i={timeType:1};"month"===this.viewType?i.timeScope=1:"three"===this.viewType&&(i.timeScope=2),t&&(i=n()({},t),t.startDate&&t.endDate&&(i.timeType=2,this.viewType="",delete i.timeScope)),this.$http.post("/material/earning/list?"+a,n()({},i)).then(function(t){if(0===t.data.code){var a=t.data.data;e.detailLists=a.list,e.pageSize=a.pageSize,e.totalCount=a.totalCount,e.filter=!1}else console.log("辅材核算明细列表失败："+t.data.msg)})},pageChange:function(t){this.pageNo=t,this.getDetailLists()},pageSizeChange:function(t){this.pageSize=t,this.getDetailLists()},filterDateChange:function(t){this.filterForm.startDate=t[0],this.filterForm.endDate=t[1]},clearFilter:function(t){this.$refs[t].resetFields(),this.filter=!1,this.viewType="month",this.getDetailLists(),this.getTotal()},sureFilter:function(){var t=n()({},this.filterForm);delete t.dateRange,this.getDetailLists(t),this.getTotal(t)}},mounted:function(){var t=this;r.a.getRepairType(function(e){t.repairLists=e}),r.a.getStationLists(function(e){t.stationLists=e}),this.getTotal(),this.getDetailLists()},watch:{viewType:function(t){t&&(this.getDetailLists(),this.getTotal())}}},o={render:function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("Card",[a("div",{staticClass:"clearfix mb-15"},[a("div",{staticClass:"pull-left"},[a("Button",{attrs:{type:"month"===t.viewType?"primary":"default"},on:{click:function(e){t.viewType="month"}}},[t._v("本月")]),t._v(" "),a("Button",{attrs:{type:"three"===t.viewType?"primary":"default"},on:{click:function(e){t.viewType="three"}}},[t._v("前三月")]),t._v(" "),a("Button",{on:{click:function(e){t.filter=!0}}},[t._v("筛选")])],1),t._v(" "),a("div",{staticClass:"pull-right"},[a("Button",{attrs:{type:"primary"}},[t._v("excel导出")])],1)]),t._v(" "),a("div",[a("div",{staticClass:"table-wrapper mb-15"},[a("table",{staticClass:"native-table"},[a("thead",[a("tr",[a("th",[t._v("采购数")]),t._v(" "),a("th",[t._v("采购成本")]),t._v(" "),a("th",[t._v("退货数")]),t._v(" "),a("th",[t._v("退货成本")]),t._v(" "),a("th",[t._v("结余")])])]),t._v(" "),a("tbody",[a("tr",[a("td",[t._v(t._s(t.earningCount.inputNum))]),t._v(" "),a("td",[t._v(t._s(t.earningCount.inputAmount))]),t._v(" "),a("td",[t._v(t._s(t.earningCount.outputNum))]),t._v(" "),a("td",[t._v(t._s(t.earningCount.outputAmount))]),t._v(" "),a("td",[t._v(t._s(t.earningCount.earning))])])])])]),t._v(" "),a("div",{staticClass:"table-wrapper mb-15"},[a("Table",{attrs:{columns:t.repairColumns,data:t.categoryEarningCountList}})],1),t._v(" "),a("div",{staticClass:"table-wrapper"},[a("h4",{staticClass:"mb-15"},[t._v("明细")]),t._v(" "),a("Table",{attrs:{columns:t.detailColumn,data:t.detailLists}}),t._v(" "),a("div",{staticClass:"pagination"},[a("Page",{attrs:{total:t.totalCount,"show-elevator":"","show-sizer":""},on:{"on-change":t.pageChange,"on-page-size-change":t.pageSizeChange}})],1)],1)]),t._v(" "),a("Drawer",{attrs:{title:"工单筛选",width:"450"},on:{"on-close":function(e){t.clearFilter("filterForm")}},model:{value:t.filter,callback:function(e){t.filter=e},expression:"filter"}},[a("div",{staticClass:"clearfix mb-15"},[a("div",{staticClass:"pull-left"},[a("Button",{on:{click:function(e){t.clearFilter("filterForm")}}},[t._v("清空筛选条件")])],1),t._v(" "),a("div",{staticClass:"pull-right"},[a("Button",{attrs:{type:"primary"},on:{click:t.sureFilter}},[t._v("确定")])],1)]),t._v(" "),a("Form",{ref:"filterForm",attrs:{model:t.filterForm,"label-position":"top"}},[a("FormItem",{attrs:{label:"报修类型",prop:"repairCategoryId"}},[a("Select",{model:{value:t.filterForm.repairCategoryId,callback:function(e){t.$set(t.filterForm,"repairCategoryId",e)},expression:"filterForm.repairCategoryId"}},t._l(t.repairLists,function(e){return a("Option",{key:e.id,attrs:{value:e.id}},[t._v(t._s(e.name))])}))],1),t._v(" "),a("FormItem",{attrs:{label:"材料名称",prop:"name"}},[a("Input",{model:{value:t.filterForm.materialName,callback:function(e){t.$set(t.filterForm,"materialName",e)},expression:"filterForm.materialName"}})],1),t._v(" "),a("FormItem",{attrs:{label:"服务网点",prop:"departmentId"}},[a("Select",{model:{value:t.filterForm.departmentId,callback:function(e){t.$set(t.filterForm,"departmentId",e)},expression:"filterForm.departmentId"}},t._l(t.stationLists,function(e){return a("Option",{key:e.id,attrs:{value:e.id}},[t._v(t._s(e.name))])}))],1),t._v(" "),a("FormItem",{attrs:{label:"时间",prop:"dateRange"}},[a("DatePicker",{staticStyle:{width:"100%"},attrs:{type:"daterange"},on:{"on-change":t.filterDateChange},model:{value:t.filterForm.dateRange,callback:function(e){t.$set(t.filterForm,"dateRange",e)},expression:"filterForm.dateRange"}})],1)],1)],1)],1)},staticRenderFns:[]};var s=a("VU/8")(l,o,!1,function(t){a("l2kO")},"data-v-d99d6fe8",null);e.default=s.exports},l2kO:function(t,e){}});
//# sourceMappingURL=11.35fc8bf3f8572c3cce8d.js.map