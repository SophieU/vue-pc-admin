webpackJsonp([43],{JZuY:function(t,e){},uAyk:function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var a=i("Dd8w"),n=i.n(a),o={name:"message-admin",data:function(){var t=this;return{loadingSave:!1,indeterminate:!0,checkAll:!1,showModal:!1,modalTitle:"新建消息",viewInfo:!1,columns:[{title:"序号",type:"index",align:"center"},{title:"消息主题",key:"title",align:"center"},{title:"发送时间",key:"createTime",align:"center"},{title:"操作人",key:"creator",align:"center"},{title:"操作",align:"center",render:function(e,i){var a=t;return e("Button",{props:{type:"text",size:"small"},on:{click:function(){var t=i.row.id;a.getInfo(t),a.modalTitle="查看消息",a.viewInfo=!0,a.showModal=!0}}},"查看")}}],lists:[],servicePort:[],pageSize:10,pageNo:1,totalCount:0,msgForm:{title:"",content:"",stationList:[]},msgFormRule:{title:[{required:!0,message:"请输入消息主题",trigger:"blur"}],content:[{required:!0,message:"请输入消息内容",trigger:"blur"}],stationList:[{required:!0,type:"array",min:1,message:"请选择网点",trigger:"change"}]}}},methods:{checkAllHandle:function(){this.indeterminate?this.checkAll=!1:this.checkAll=!this.checkAll,this.indeterminate=!1,this.checkAll?this.msgForm.stationList=this.servicePort.map(function(t){return t.id}):this.msgForm.stationList=[]},checkAllGroupChange:function(t){t.length===this.servicePort.length?(this.indeterminate=!1,this.checkAll=!0):t.length>0?(this.indeterminate=!0,this.checkAll=!1):(this.indeterminate=!1,this.checkAll=!1)},getLists:function(){var t=this,e=this.pageSize,i=this.pageNo;this.$http.get("/notice/list?pageSize="+e+"&pageNo="+i).then(function(e){0===e.data.code?(t.lists=e.data.data.list,t.totalCount=e.data.data.totalCount,t.pageSize=e.data.data.pageSize):console.log("信息获取失败："+e.data.msg)})},getPort:function(){var t=this;this.$http.get("/repair/station/select/list").then(function(e){0===e.data.code&&(t.servicePort=e.data.data)})},getInfo:function(t){var e=this;this.$http.get("/notice/info?id="+t).then(function(t){if(0===t.data.code){var i=t.data.data;delete i.callCenterId,e.msgForm=i}})},sureSend:function(){var t=this;this.loadingSave=!0;var e=this.msgForm;this.$refs.msgForm.validate(function(i){i?t.$http.post("/notice/add",n()({},e)).then(function(e){0===e.data.code?(t.$Message.success("发送成功"),t.pageNo=1,t.pageSize=10,t.getLists()):t.$Message.error(e.data.msg),t.showModal=!1,t.loadingSave=!1}):t.loadingSave=!1})},modalHide:function(t){t||(this.modalTitle="新建消息",this.viewInfo=!1,this.msgForm={title:"",content:"",stationList:[]},this.$refs.msgForm.resetFields())},pageChange:function(t){this.pageNo=t,this.getLists()},pageSizeChange:function(t){this.pageSize=t,this.getLists()}},created:function(){this.getLists(),this.getPort()}},s={render:function(){var t=this,e=t.$createElement,i=t._self._c||e;return i("Card",[i("div",{staticClass:"mb-15"},[i("Button",{staticClass:"lang-btn",attrs:{type:"primary"},on:{click:function(e){t.showModal=!0}}},[t._v("新建")])],1),t._v(" "),i("Table",{attrs:{columns:t.columns,data:t.lists}}),t._v(" "),i("div",{staticClass:"pagination"},[i("Page",{attrs:{total:t.totalCount,"page-size":t.pageSize,"show-sizer":"","show-elevator":""},on:{"on-change":t.pageChange,"on-page-size-change":t.pageSizeChange}})],1),t._v(" "),i("Modal",{attrs:{width:"700",title:t.modalTitle,"mask-closable":!1},on:{"on-visible-change":t.modalHide},model:{value:t.showModal,callback:function(e){t.showModal=e},expression:"showModal"}},[i("Form",{ref:"msgForm",attrs:{model:t.msgForm,rules:t.msgFormRule,"label-position":"top"}},[i("Row",{attrs:{gutter:25}},[i("Col",{attrs:{span:"12"}},[i("FormItem",{attrs:{label:"消息主题",prop:"title"}},[i("Input",{attrs:{disabled:t.viewInfo,maxlength:100,placeholder:"消息主题最多100字"},model:{value:t.msgForm.title,callback:function(e){t.$set(t.msgForm,"title",e)},expression:"msgForm.title"}})],1),t._v(" "),i("FormItem",{attrs:{label:"消息内容",prop:"content"}},[i("Input",{attrs:{disabled:t.viewInfo,type:"textarea",rows:5},model:{value:t.msgForm.content,callback:function(e){t.$set(t.msgForm,"content",e)},expression:"msgForm.content"}})],1)],1),t._v(" "),i("Col",{attrs:{span:"12"}},[i("FormItem",{attrs:{label:"发送服务网点",prop:"stationList"}},[i("div",[i("Checkbox",{attrs:{indeterminate:t.indeterminate,value:t.checkAll,disabled:t.viewInfo},nativeOn:{click:function(e){return e.preventDefault(),t.checkAllHandle(e)}}},[t._v("全选")])],1),t._v(" "),i("CheckboxGroup",{on:{"on-change":t.checkAllGroupChange},model:{value:t.msgForm.stationList,callback:function(e){t.$set(t.msgForm,"stationList",e)},expression:"msgForm.stationList"}},t._l(t.servicePort,function(e){return i("Checkbox",{key:e.id,attrs:{disabled:t.viewInfo,label:e.id}},[t._v(t._s(e.name))])}))],1)],1)],1)],1),t._v(" "),i("div",{attrs:{slot:"footer"},slot:"footer"},[t.viewInfo?t._e():i("Button",{on:{click:function(e){t.showModal=!1}}},[t._v("取消")]),t._v(" "),t.viewInfo?t._e():i("Button",{attrs:{loading:t.loadingSave,type:"primary"},on:{click:t.sureSend}},[t._v("确认并发送")]),t._v(" "),t.viewInfo?i("Button",{attrs:{type:"primary"},on:{click:function(e){t.showModal=!1}}},[t._v("关闭")]):t._e()],1)],1)],1)},staticRenderFns:[]};var l=i("VU/8")(o,s,!1,function(t){i("JZuY")},"data-v-26104654",null);e.default=l.exports}});
//# sourceMappingURL=43.b4b223d988eea738ce88.js.map