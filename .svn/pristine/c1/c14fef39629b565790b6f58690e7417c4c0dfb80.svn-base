webpackJsonp([23],{"Gwl/":function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var a=i("Dd8w"),r=i.n(a),n=i("TVG1"),o={name:"finance-view",data:function(){var t=this;return{viewType:"month",filter:!1,repairColumns:[{title:"报修类型",key:"name",align:"center"},{title:"已付工单总数",key:"orderNum",align:"center"},{title:"已付工单收入",key:"orderAmount",align:"center"},{title:"员工结算",key:"employeeCommission",align:"center"},{title:"平台佣金",key:"platformCommission",align:"center"},{title:"服务收益",key:"serviceEarning",align:"center"}],detailColumn:[{title:"创建日期",key:"createTime",align:"center",width:140},{title:"付款时间",key:"payTime",align:"center",width:140},{title:"工单单号",key:"orderSn",align:"center",minWidth:160},{title:"支付方式",key:"payType",align:"center",width:100},{title:"交易号",key:"paySn",align:"center",width:140},{title:"报修类型",key:"repairCategoryName",align:"center",width:100},{title:"服务网点",key:"stationName",align:"center",width:100},{title:"工单状态",key:"orderState",align:"center",width:100},{title:"工单金额",key:"orderAmount",align:"center",width:100},{title:"师傅姓名",key:"serverName",align:"center",width:100},{title:"师傅提成",key:"employeeCommission",align:"center",width:100},{title:"平台佣金比",key:"platformCommissionRate",align:"center",width:100},{title:"平台佣金",key:"platformCommission",align:"center",width:100},{title:"操作",fixed:"right",width:100,align:"center",render:function(e,i){var a=t;return e("Button",{props:{type:"text"},on:{click:function(){var t=i.row.id;a.$router.push({name:"orderDetail",params:{id:t}})}}},"查看订单")}}],repairLists:[],stationLists:[],detailLists:[],earningCount:{},categoryEarningCountList:[],detailPageTotal:0,detailPageSize:10,detailPageNo:1,filterForm:{repairCategoryId:"",serverName:"",stationId:"",dateRange:[]}}},methods:{getOrderLists:function(t){var e=this,i="pageNo="+this.detailPageNo+"&pageSize="+this.detailPageSize,a={timeType:1};"month"===this.viewType?a.timeScope=1:"three"===this.viewType&&(a.timeScope=2),t&&(a=r()({},t),t.startDate&&t.endDate&&(a.timeType=2,a.timeScope=""));var o=n.a.formatterParams(a);this.$http.post("/order/earning/list?"+i+"&"+o).then(function(t){if(0===t.data.code){var i=t.data.data;e.detailLists=i.list,e.detailPageTotal=i.totalCount,e.detailPageSize=i.pageSize,e.filter=!1}})},getOrderTotal:function(t){var e=this,i={timeType:1};"month"===this.viewType?i.timeScope=1:"three"===this.viewType&&(i.timeScope=2),t&&(i=r()({},t),t.startDate&&t.endDate&&(i.timeType=2,delete i.timeScope));var a=n.a.formatterParams(i);this.$http.post("/order/earning/count?"+a).then(function(i){if(0===i.data.code){var a=i.data.data;e.earningCount=a.earningCount,e.categoryEarningCountList=a.categoryEarningCountList,e.filter=!1,t&&t.startDate&&(e.viewType="")}else console.log("财务统计信息失败："+i.data.msg)})},clearFilter:function(t){this.$refs[t].resetFields(),this.filter=!1,this.getOrderLists(),this.getOrderTotal()},sureFilter:function(){var t=r()({},this.filterForm);t.dateRange&&delete t.dateRange,this.getOrderLists(t),this.getOrderTotal(t)},pageChange:function(t){this.pageNo=t,this.getOrderLists()},pageSizeChange:function(t){this.pageSize=t,this.getOrderLists()},filterDateChange:function(t){this.filterForm.startDate=t[0],this.filterForm.endDate=t[1]},exportExcel:function(){var t=r()({},this.filterForm),e={timeType:1};for(var i in"month"===this.viewType?e.timeScope=1:"three"===this.viewType&&(e.timeScope=2),t)(t[i].length>0||t[i]>0)&&(e[i]=t[i]),e.startDate&&e.endDate&&(e.timeType=2,delete e.timeScope,delete e.dateRange);var a=n.a.formatterParams(e);this.$http.post("/order/earning/export?"+a,null,{responseType:"blob"}).then(function(t){n.a.downloadExcel(t)})}},mounted:function(){var t=this;this.getOrderLists(),this.getOrderTotal(),n.a.getRepairType(function(e){t.repairLists=e}),n.a.getStationLists(function(e){t.stationLists=e})},watch:{viewType:function(t){t&&(this.getOrderLists(),this.getOrderTotal())}}},s={render:function(){var t=this,e=t.$createElement,i=t._self._c||e;return i("div",[i("Card",{staticClass:"mb-15"},[i("div",{staticClass:"clearfix mb-15"},[i("div",{staticClass:"pull-left"},[i("Button",{attrs:{type:"month"===t.viewType?"primary":"default"},on:{click:function(e){t.viewType="month"}}},[t._v("本月")]),t._v(" "),i("Button",{attrs:{type:"three"===t.viewType?"primary":"default"},on:{click:function(e){t.viewType="three"}}},[t._v("前三月")]),t._v(" "),i("Button",{on:{click:function(e){t.filter=!0}}},[t._v("筛选")])],1),t._v(" "),i("div",{staticClass:"pull-right"},[i("Button",{attrs:{type:"primary"},on:{click:t.exportExcel}},[t._v("excel导出")])],1)]),t._v(" "),i("div",[i("div",{staticClass:"table-wrapper mb-15"},[i("table",{staticClass:"native-table"},[i("thead",[i("tr",[i("th",[t._v("项目名称")]),t._v(" "),i("th",[t._v("已付工单总数")]),t._v(" "),i("th",[t._v("已付工单收入")]),t._v(" "),i("th",[t._v("员工结算")]),t._v(" "),i("th",[t._v("平台佣金")]),t._v(" "),i("th",[t._v("服务收益")])])]),t._v(" "),i("tbody",[i("tr",[i("td",[t._v(t._s(t.earningCount.name))]),t._v(" "),i("td",[t._v(t._s(t.earningCount.orderNum))]),t._v(" "),i("td",[t._v(t._s(t.earningCount.orderAmount))]),t._v(" "),i("td",[t._v(t._s(t.earningCount.employeeCommission))]),t._v(" "),i("td",[t._v(t._s(t.earningCount.platformCommission))]),t._v(" "),i("td",[t._v(t._s(t.earningCount.serviceEarning))])])])])]),t._v(" "),i("div",{staticClass:"table-wrapper mb-15"},[i("Table",{attrs:{columns:t.repairColumns,data:t.categoryEarningCountList}})],1)])]),t._v(" "),i("Card",[i("p",{attrs:{slot:"title"},slot:"title"},[t._v("明细")]),t._v(" "),i("div",{staticClass:"table-wrapper"},[i("Table",{attrs:{columns:t.detailColumn,data:t.detailLists}}),t._v(" "),i("div",{staticClass:"pagination"},[i("Page",{attrs:{total:t.detailPageTotal,"show-sizer":"","show-elevator":""},on:{"on-change":t.pageChange,"on-page-size-change":t.pageSizeChange}})],1)],1)]),t._v(" "),i("Drawer",{attrs:{title:"工单筛选",width:"450"},model:{value:t.filter,callback:function(e){t.filter=e},expression:"filter"}},[i("div",{staticClass:"clearfix mb-15"},[i("div",{staticClass:"pull-left"},[i("Button",{on:{click:function(e){t.clearFilter("filterForm")}}},[t._v("清空筛选条件")])],1),t._v(" "),i("div",{staticClass:"pull-right"},[i("Button",{attrs:{type:"primary"},on:{click:t.sureFilter}},[t._v("确定")])],1)]),t._v(" "),i("Form",{ref:"filterForm",attrs:{model:t.filterForm,"label-position":"top"}},[i("FormItem",{attrs:{label:"报修类型",prop:"repairCategoryId"}},[i("Select",{model:{value:t.filterForm.repairCategoryId,callback:function(e){t.$set(t.filterForm,"repairCategoryId",e)},expression:"filterForm.repairCategoryId"}},t._l(t.repairLists,function(e){return i("Option",{key:e.id,attrs:{value:e.id}},[t._v(t._s(e.name))])}))],1),t._v(" "),i("FormItem",{attrs:{label:"服务人员",prop:"serverName"}},[i("Input",{model:{value:t.filterForm.serverName,callback:function(e){t.$set(t.filterForm,"serverName",e)},expression:"filterForm.serverName"}})],1),t._v(" "),i("FormItem",{attrs:{label:"服务网点",prop:"stationId"}},[i("Select",{model:{value:t.filterForm.stationId,callback:function(e){t.$set(t.filterForm,"stationId",e)},expression:"filterForm.stationId"}},t._l(t.stationLists,function(e){return i("Option",{key:e.id,attrs:{value:e.id}},[t._v(t._s(e.name))])}))],1),t._v(" "),i("FormItem",{attrs:{label:"付款时间",prop:"dateRange"}},[i("DatePicker",{staticStyle:{width:"100%"},attrs:{type:"daterange"},on:{"on-change":t.filterDateChange},model:{value:t.filterForm.dateRange,callback:function(e){t.$set(t.filterForm,"dateRange",e)},expression:"filterForm.dateRange"}})],1)],1)],1)],1)},staticRenderFns:[]};var l=i("VU/8")(o,s,!1,function(t){i("YYZp")},"data-v-8bfd677e",null);e.default=l.exports},YYZp:function(t,e){}});
//# sourceMappingURL=23.11f158c1fb7d0ae14420.js.map