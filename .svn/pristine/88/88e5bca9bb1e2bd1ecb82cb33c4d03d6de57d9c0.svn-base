webpackJsonp([47],{IUMT:function(t,e,a){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var o=a("Dd8w"),i=a.n(o),l=a("TVG1"),r={name:"fault-type",computed:{uploadUrl:function(){return this.$http.defaults.baseURL+"/fault/reason/import"}},data:function(){var t=this;return{loadingSend:!1,uploadingModal:!1,uploadPercent:0,modalTitle:"新建",faultModal:!1,filter:!1,tableColumn:[{title:"故障名称",key:"name",align:"center"},{title:"报修分类",key:"repairCategoryName",align:"center"},{title:"操作",align:"center",render:function(e,a){var o=t;return e("div",[e("Button",{props:{type:"text"},on:{click:function(){var t=a.row.id;o.getInfo(t)}}},"编辑"),e("Button",{props:{type:"text"},on:{click:function(){var t=a.row.id;o.$store.commit("setDeleteModal",{model:!0,callback:function(){o.deleteType(t)}})}}},"删除")])}}],lists:[],repairLists:[],typeForm:{id:"",repairCategoryId:"",name:""},typeFormRule:{name:[{required:!0,message:"请输入故障名称",trigger:"blur"}],repairCategoryId:[{required:!0,message:"请选择报修分类",trigger:"change"}]},faultFilter:{name:"",repairCategoryId:""}}},methods:{newFaultModal:function(){this.faultModal=!0,this.modalTitle="新增"},getLists:function(t){var e=this,a="";t&&(a=l.a.formatterParams(t)),this.$http.get("/fault/reason/list?"+a).then(function(t){0===t.data.code?e.lists=t.data.data:e.$Message.error(t.data.msg),e.filter=!1})},getInfo:function(t){var e=this;this.$http.get("/fault/reason/info?id="+t).then(function(t){0===t.data.code?(e.typeForm=t.data.data,e.modalTitle="编辑",e.faultModal=!0):e.$Message.error(t.data.msg)})},getRepairList:function(){var t=this;this.$http.get("/repair/category/list").then(function(e){0===e.data.code?t.repairLists=e.data.data:console.log("故障原因管理-获取报修分类失败："+e.data.msg)})},download:function(){this.$http.get("/fault/reason/import/template",{responseType:"blob"}).then(function(t){l.a.downloadExcel(t)})},uploadSuccess:function(t,e,a){var o=this;setTimeout(function(){0===t.code?o.$Message.success("上传成功"):o.$Message.error(t.msg),o.$store.commit("setUploadProgress",!1),o.$store.commit("setUploadPercent",100),o.getLists()},1e3)},uploading:function(){this.$store.commit("setUploadProgress",!0),this.$store.commit("setUploadPercent",0)},saveFaultType:function(){var t=this;this.loadingSend=!0,this.$refs.typeForm.validate(function(e){if(e){var a="",o=t.typeForm;a=o.id.length<=0?"/fault/reason/add":"/fault/reason/edit",t.$http.post(a,i()({},o)).then(function(e){0===e.data.code?(t.$Message.success("保存成功"),t.faultModal=!1,t.getLists()):t.$Message.error(e.data.msg),t.loadingSend=!1})}else t.loadingSend=!1})},deleteType:function(t){var e=this;this.$http.delete("/fault/reason/delete?id="+t).then(function(t){0===t.data.code?(e.$Message.info("删除成功"),e.$store.commit("setDeleteModal",{model:!1}),e.getLists()):(e.$Message.error("删除失败"),_this.$store.commit("setDeleteModal",{model:!1}))})},modalHide:function(t){t||(this.typeForm={id:"",repairCategoryId:"",name:""},this.$refs.typeForm.resetFields())},clearFilter:function(){this.faultFilter={name:"",repairCategoryId:""},this.getLists()},filterData:function(){var t=i()({},this.faultFilter);this.getLists(t)}},mounted:function(){this.getLists(),this.getRepairList()}},s={render:function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("div",[a("Card",[a("div",[a("div",{staticClass:"clearfix mb-15"},[a("div",{staticClass:"pull-left"},[a("Button",{attrs:{icon:"md-add"},on:{click:t.newFaultModal}},[t._v("新建")]),t._v(" "),a("Button",{attrs:{icon:"ios-funnel"},on:{click:function(e){t.filter=!0}}},[t._v("筛选")])],1),t._v(" "),a("div",{staticClass:"pull-right"},[a("Button",{on:{click:t.download}},[t._v("excel导入模板下载")]),t._v(" "),a("div",{staticClass:"inline-block"},[a("Upload",{attrs:{action:t.uploadUrl,"with-credentials":!0,"on-success":t.uploadSuccess,"before-upload":t.uploading,"show-upload-list":!1}},[a("Button",{attrs:{icon:"ios-cloud-upload-outline"}},[t._v("excel导入")])],1)],1)],1)]),t._v(" "),a("div",{staticClass:"table-wrapper"},[a("Table",{attrs:{data:t.lists,columns:t.tableColumn}})],1)])]),t._v(" "),a("Modal",{attrs:{"mask-closable":!1,title:t.modalTitle+"故障原因管理"},on:{"on-visible-change":t.modalHide},model:{value:t.faultModal,callback:function(e){t.faultModal=e},expression:"faultModal"}},[a("div",{staticClass:"modal_wrap_form"},[a("Form",{ref:"typeForm",attrs:{model:t.typeForm,rules:t.typeFormRule,"label-position":"top"}},[a("FormItem",{attrs:{label:"报修分类",prop:"repairCategoryId"}},[a("Select",{model:{value:t.typeForm.repairCategoryId,callback:function(e){t.$set(t.typeForm,"repairCategoryId",e)},expression:"typeForm.repairCategoryId"}},t._l(t.repairLists,function(e){return a("Option",{key:e.id,attrs:{value:e.id}},[t._v(t._s(e.name))])}))],1),t._v(" "),a("FormItem",{attrs:{label:"故障名称",prop:"name"}},[a("Input",{model:{value:t.typeForm.name,callback:function(e){t.$set(t.typeForm,"name",e)},expression:"typeForm.name"}})],1)],1)],1),t._v(" "),a("div",{attrs:{slot:"footer"},slot:"footer"},[a("Button",{on:{click:function(e){t.faultModal=!1}}},[t._v("取消")]),t._v(" "),a("Button",{attrs:{loading:t.loadingSend,type:"primary"},on:{click:t.saveFaultType}},[t._v(t._s("新增"===t.modalTitle?"添加":"保存"))])],1)]),t._v(" "),a("Drawer",{attrs:{title:"报修筛选",width:"425"},model:{value:t.filter,callback:function(e){t.filter=e},expression:"filter"}},[a("div",{staticClass:"filter-top mb-15 clearfix"},[a("div",{staticClass:"pull-left"},[a("Button",{attrs:{icon:"md-close-circle"},on:{click:t.clearFilter}},[t._v("清空筛选条件")])],1),t._v(" "),a("div",{staticClass:"pull-right"},[a("Button",{attrs:{type:"primary"},on:{click:t.filterData}},[t._v("确定筛选")])],1)]),t._v(" "),a("Form",{attrs:{model:t.faultFilter}},[a("FormItem",{attrs:{label:"报修分类"}},[a("Select",{model:{value:t.faultFilter.repairCategoryId,callback:function(e){t.$set(t.faultFilter,"repairCategoryId",e)},expression:"faultFilter.repairCategoryId"}},t._l(t.repairLists,function(e){return a("Option",{key:e.id,attrs:{value:e.id}},[t._v(t._s(e.name))])}))],1),t._v(" "),a("FormItem",{attrs:{label:"故障名称"}},[a("Input",{model:{value:t.faultFilter.name,callback:function(e){t.$set(t.faultFilter,"name",e)},expression:"faultFilter.name"}})],1)],1)],1)],1)},staticRenderFns:[]};var n=a("VU/8")(r,s,!1,function(t){a("KDiv")},"data-v-0236d1a1",null);e.default=n.exports},KDiv:function(t,e){}});
//# sourceMappingURL=47.d5b8f36318327b9e7291.js.map