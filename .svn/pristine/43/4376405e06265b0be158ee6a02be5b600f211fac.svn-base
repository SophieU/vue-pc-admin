webpackJsonp([9],{"4Ibr":function(t,e){},"pd/c":function(t,e,a){"use strict";var i=a("mvHQ"),s=a.n(i),r=a("TVG1"),n={name:"choose-material",props:["showModal","alreadyExist","hasInput"],data:function(){return{indeterminate:!1,checkAll:!1,repairType:[{name:"全部",id:"0"}],searchForm:{categoryId:"",searchKey:"",pageSize:15,pageNo:1},materialLists:[],materialTotal:0,materialCheck:[],materialCheckTemp:[],materialCheckedlists:[]}},methods:{getRepairType:function(){var t=this;this.$http.get("/repair/category/list").then(function(e){0===e.data.code?t.repairType=t.repairType.concat(e.data.data):console.log("报修分类获取失败："+e.data.msg)})},toggleCheckAll:function(){var t=this;this.indeterminate?this.checkAll=!1:this.checkAll=!this.checkAll,this.indeterminate=!1,this.checkAll?this.materialLists.map(function(e,a){e.checked="1-"+a,t.materialCheckTemp.push(e)}):this.materialLists.map(function(e,a){e.checked="0-"+a,t.materialCheckTemp=t.materialCheckTemp.filter(function(e,a){if(s()(t.materialLists).indexOf(e.id)<=-1)return!0})})},searchMaterial:function(){var t=this,e=this.searchForm;"0"===e.categoryId&&delete e.categoryId;var a=r.a.formatterParams(e);this.hasInput&&(a+="&hasInput=Y"),this.$http.post("/repair/material/category/selectList?"+a).then(function(e){if(0===e.data.code){var a=e.data.data,i=t.materialCheckTemp;t.materialLists=a.list.map(function(t,e){return i.forEach(function(a){t.id===a.id&&(t.checked="1-"+e)}),t.checked||(t.checked="0-"+e),t});var s=t.materialLists;t.materialLists=t.compareChoosed(t.alreadyExist,s),t.materialTotal=a.totalCount}else console.log("辅材搜索失败："+e.data.msg)})},modalVisible:function(t){t?this.searchMaterial():(this.checkAll=!1,this.indeterminate=!1,this.materialCheckTemp=[],this.materialLists=[],this.searchForm={categoryId:"",searchKey:"",pageSize:15,pageNo:1})},checkChange:function(t){var e=this,a=this.materialLists,i=(t=t.split("-"))[0],s=parseInt(t[1]);this.indeterminate=!0,this.checkAll=!1,"1"===i?this.materialCheckTemp.push(a[s]):this.materialCheckTemp.map(function(t,i){t.id===a[s].id&&e.materialCheckTemp.splice(i,1)})},sureMaterial:function(){var t=this.materialCheckTemp,e=s()(this.alreadyExist),a=(t=t.filter(function(t){var a=t.id;if(e.indexOf(a)<=-1)return!0})).map(function(t){return t.num=null,t.amount=null,t.price?t.price*=1:t.price=null,t});this.$emit("checkSubmit",a)},compareChoosed:function(t,e){return e=e.map(function(e){return t.forEach(function(t){e.id===t.id&&(e.disabled=!0)}),e.disabled||(e.disabled=!1),e})},materialPageChange:function(t){this.searchForm.pageNo=t,this.indeterminate=!1,this.checkAll=!1,this.searchMaterial()}},mounted:function(){this.getRepairType(),this.searchMaterial()},watch:{showModal:function(t){this.materialCheckTemp=JSON.parse(s()(this.alreadyExist))}}},l={render:function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("Modal",{attrs:{fullscreen:"",closable:!1,"mask-closable":!1,title:"选择辅材",width:"650"},on:{"on-visible-change":t.modalVisible},model:{value:t.showModal,callback:function(e){t.showModal=e},expression:"showModal"}},[a("div",[a("div",{staticClass:"mb-15"},[a("i-form",{ref:"searchForm",attrs:{model:t.searchForm,inline:"","label-width":70}},[a("form-item",{attrs:{label:"辅材类别"}},[a("Select",{staticStyle:{width:"160px"},model:{value:t.searchForm.categoryId,callback:function(e){t.$set(t.searchForm,"categoryId",e)},expression:"searchForm.categoryId"}},t._l(t.repairType,function(e){return a("Option",{key:e.id,attrs:{value:e.id}},[t._v(t._s(e.name))])}))],1),t._v(" "),a("form-item",{attrs:{label:"关键字"}},[a("Input",{attrs:{placeholder:"请输入辅材名称"},model:{value:t.searchForm.searchKey,callback:function(e){t.$set(t.searchForm,"searchKey",e)},expression:"searchForm.searchKey"}})],1),t._v(" "),a("Button",{attrs:{type:"primary"},on:{click:t.searchMaterial}},[t._v("搜索")])],1)],1),t._v(" "),a("div",{staticClass:"table-wrapper"},[a("table",{staticClass:"native-table"},[a("thead",[a("tr",[a("th",[t._v("辅材名称")]),t._v(" "),a("th",[t._v("型号")]),t._v(" "),a("th",[t._v("单位")]),t._v(" "),a("th",[a("Checkbox",{attrs:{indeterminate:t.indeterminate},nativeOn:{click:function(e){return e.preventDefault(),t.toggleCheckAll(e)}},model:{value:t.checkAll,callback:function(e){t.checkAll=e},expression:"checkAll"}},[t._v("全选")])],1)])]),t._v(" "),a("tbody",t._l(t.materialLists,function(e,i){return a("tr",{key:e.id},[a("td",[t._v(t._s(e.name))]),t._v(" "),a("td",[t._v(t._s(e.spec))]),t._v(" "),a("td",[t._v(t._s(e.unit))]),t._v(" "),a("td",[a("Checkbox",{attrs:{disabled:e.disabled,"true-value":"1-"+i,"false-value":"0-"+i},on:{"on-change":t.checkChange},model:{value:e.checked,callback:function(a){t.$set(e,"checked",a)},expression:"material.checked"}},[t._v("选择")])],1)])}))]),t._v(" "),a("div",{staticClass:"pagination"},[a("Page",{attrs:{current:t.searchForm.pageNo,size:"small",total:t.materialTotal,"page-size":15},on:{"update:current":function(e){t.$set(t.searchForm,"pageNo",e)},"on-change":t.materialPageChange}})],1)])]),t._v(" "),a("div",{attrs:{slot:"footer"},slot:"footer"},[a("Button",{on:{click:function(e){t.$emit("close")}}},[t._v("关闭")]),t._v(" "),a("Button",{attrs:{type:"primary"},on:{click:t.sureMaterial}},[t._v("确认")])],1)])},staticRenderFns:[]};var c=a("VU/8")(n,l,!1,function(t){a("xx7E")},"data-v-3bb5ee7e",null);e.a=c.exports},qZI0:function(t,e,a){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var i=a("Dd8w"),s=a.n(i),r=a("TVG1"),n={name:"new-out",components:{CheckModal:a("pd/c").a},data:function(){return{sureAdd:!1,loadingSave:!1,showModal:!1,outputForm:{sn:"",outputType:""},outputFormRule:{outputType:[{required:!0,message:"请选择出库类型",trigger:"change"}]},repairType:[],materialCheckedlists:[],materialLists:[]}},methods:{deleteMater:function(t){this.materialCheckedlists.splice(t,1)},searchMaterial:function(){var t=this,e=r.a.formatterParams(this.searchForm);this.$http.post("/repair/material/category/selectList?&hasInput=Y&"+e).then(function(e){if(0===e.data.code){var a=e.data.data,i=t.materialCheckTemp;t.materialLists=a.list.map(function(t,e){return i.forEach(function(a){t.id===a.id&&(t.checked="1-"+e)}),t.checked||(t.checked="0-"+e),t});var s=t.materialCheck,r=t.materialLists;t.materialLists=t.compareChoosed(s,r),t.materialTotal=a.totalCount}else console.log("辅材搜索失败："+e.data.msg)})},checkSubmit:function(t){this.showModal=!1,this.materialCheckedlists=this.materialCheckedlists.concat(t)},numChange:function(t,e){this.materialCheckedlists=this.materialCheckedlists.map(function(t,a){return e===a&&t.num>0&&(t.amount=(t.price*t.num).toFixed(2)),t})},sureOut:function(){var t=this;this.loadingSave=!0;var e=this.outputForm,a=this.materialCheckedlists,i=!0;this.materialCheckedlists=a.map(function(t){return t.notValidType=[],t.notValid=!1,t.num||(i=!1,t.notValid=!0,t.notValidType.push("num")),t}),i?this.$refs.outForm.validate(function(i){i?(e.detailList=a.map(function(t){return{materialId:t.id,price:t.price,amount:t.amount,num:t.num}}),t.$http.post("/repair/material/output/order/add",s()({},e)).then(function(e){t.loadingSave=!1,0===e.data.code?(t.$Message.success("保存成功"),t.$router.push({name:"output"})):t.$Message.error(e.data.msg)})):t.loadingSave=!1}):this.loadingSave=!1}}},l={render:function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("Card",{staticStyle:{"padding-bottom":"30px"}},[a("div",{staticClass:"clearfix mb-15"},[a("div",{staticClass:"pull-left"},[a("Button",{on:{click:function(e){t.$router.back()}}},[t._v("返回上一页")])],1),t._v(" "),a("div",{staticClass:"pull-right"},[a("Button",{attrs:{loading:t.loadingSave,type:"primary"},on:{click:t.sureOut}},[t._v("确定出库")])],1)]),t._v(" "),a("i-form",{ref:"outForm",staticStyle:{"margin-right":"200px"},attrs:{model:t.outputForm,rules:t.outputFormRule,"label-width":100}},[a("form-item",{attrs:{label:"出库类型",prop:"outputType"}},[a("Select",{staticClass:"w300",model:{value:t.outputForm.outputType,callback:function(e){t.$set(t.outputForm,"outputType",e)},expression:"outputForm.outputType"}},[a("Option",{attrs:{value:"REFUND"}},[t._v("退货")])],1)],1),t._v(" "),a("form-item",{attrs:{label:"原始单号"}},[a("Input",{staticClass:"w400",model:{value:t.outputForm.sn,callback:function(e){t.$set(t.outputForm,"sn",e)},expression:"outputForm.sn"}})],1),t._v(" "),a("form-item",{attrs:{label:"辅材"}},[a("Button",{on:{click:function(e){t.showModal=!0}}},[t._v("添加辅材")])],1)],1),t._v(" "),a("div",{staticClass:"table-wrapper"},[a("table",{staticClass:"native-table"},[a("thead",[a("tr",[a("th",[t._v("辅材名称")]),t._v(" "),a("th",[t._v("型号")]),t._v(" "),a("th",[t._v("单位")]),t._v(" "),a("th",[t._v("单价")]),t._v(" "),a("th",[t._v("数量  "),a("span",{staticClass:"text-red"},[t._v("*")])]),t._v(" "),a("th",[t._v("出库成本")]),t._v(" "),a("th",[t._v("操作")])])]),t._v(" "),a("tbody",t._l(t.materialCheckedlists,function(e,i){return a("tr",{key:i},[a("td",[t._v(t._s(e.name))]),t._v(" "),a("td",[t._v(t._s(e.spec))]),t._v(" "),a("td",[t._v(t._s(e.unit))]),t._v(" "),a("td",[t._v(t._s(e.price))]),t._v(" "),a("td",{staticStyle:{width:"200px"}},[a("InputNumber",{staticStyle:{width:"80%"},attrs:{step:1,min:0,placeholder:"请输入数量"},on:{"on-change":function(a){t.numChange(e.num,i)}},model:{value:e.num,callback:function(a){t.$set(e,"num",a)},expression:"material.num"}}),t._v(" "),e.notValid&&e.notValidType.indexOf("num")>-1?a("p",{staticClass:"text-red"},[t._v("请输入数量")]):t._e()],1),t._v(" "),a("td",[t._v(t._s(e.amount))]),t._v(" "),a("td",[a("Button",{staticClass:"text-red",attrs:{type:"text"},on:{click:function(e){t.deleteMater(i)}}},[t._v("删除")])],1)])}))])]),t._v(" "),a("CheckModal",{attrs:{hasInput:!0,alreadyExist:t.materialCheckedlists,showModal:t.showModal},on:{close:function(e){t.showModal=!1},checkSubmit:t.checkSubmit}})],1)},staticRenderFns:[]};var c=a("VU/8")(n,l,!1,function(t){a("4Ibr")},"data-v-cbcdb7ae",null);e.default=c.exports},xx7E:function(t,e){}});