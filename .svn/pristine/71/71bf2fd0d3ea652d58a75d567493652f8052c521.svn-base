webpackJsonp([8],{"0PqJ":function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var a=r("woOf"),i=r.n(a),s=r("Dd8w"),o=r.n(s),n=r("TVG1"),l={name:"order-search",components:{createOrder:r("spv5").a},computed:{downLink:function(){return localStorage.getItem("baseURL")+"/repair/order/list/export"}},data:function(){var e=this;return{telValid:!0,showModal:!1,filter:!1,currentTab:"",orderNav:[{title:"所有工单",state:"",count:0,check:!0},{title:"待分配",state:"ASSIGNED",count:0},{title:"待上门",state:"WAIT_DOOR",count:0},{title:"已上门",state:"WAITING_DOOR",count:0},{title:"待付款",state:"STAY_PAY",count:0},{title:"待服务",state:"WAIT_SERVICE",count:0},{title:"已完成",state:"FINISH",count:0},{title:"售后中",state:"AFTER_SALE",count:0},{title:"已取消",state:"CANCEL",count:0},{title:"已关闭",state:"CLOSED",count:0},{title:"异常",state:"EXCEPTION",count:0}],columns:[{title:"工单编号",key:"orderSn",align:"center",minWidth:200},{title:"客户手机",key:"userPhone",align:"center",width:120},{title:"报修类型",key:"repairCategoryName",align:"center",width:100},{title:"服务网点",key:"stationName",align:"center",width:100},{title:"接单师傅",key:"receiveUserName",align:"center",width:100},{title:"工单状态",key:"orderState",align:"center",width:100},{title:"证据",key:"hasEvidence",align:"center",width:100},{title:"回访记录",key:"hasReturnVisit",align:"center",width:100},{title:"质保中",key:"qualityAssurance",align:"center",width:100},{title:"售后中",key:"isAfterSale",align:"center",width:100},{title:"售后记录",key:"afterSaleRecord",align:"center",width:100},{title:"创建日期",key:"createTime",sortable:!0,align:"center",minWidth:150},{title:"操作",fixed:"right",align:"center",width:150,render:function(t,r){var a=e;return t("div",[t("Button",{props:{type:"text",size:"small"},on:{click:function(){var e=r.row.id;sessionStorage.setItem("viewOrderId",e),a.$router.push({name:"orderDetail",query:{id:e}})}}},"查看"),t("Button",{props:{type:"text",size:"small"},on:{click:function(){var e=r.row.id,t=r.row.orderState,i=r.row.isInWarrantyPeriod;sessionStorage.setItem("viewOrderId",e),a.$router.push({name:"orderControl",query:{id:e,state:t,isWarranty:i}})}}},"处理订单")])}}],lists:[],filterForm:{},inFilter:!1,pageNo:1,pageSize:10,totalCount:0,repairLists:[]}},methods:{validateTel:function(e){/^1[3456789]\d{9}/.test(e)?this.telValid=!0:this.telValid=!1,e||(this.telValid=!0)},downloadExcel:function(){var e=o()({},this.filterForm);delete e.dateRange,this.$http.post("/repair/order/list/export",o()({},e),{responseType:"blob"}).then(function(e){n.a.downloadExcel(e)})},toggleTab:function(e){var t=this,r=this.orderNav.map(function(r,a){return a===e?(r.check=!0,t.currentTab=r.state):r.check=!1,r});this.orderNav=r},closeModal:function(e){this.showModal=!1,this.getLists()},getLists:function(){var e=this,t={pageNo:this.pageNo,pageSize:this.pageSize},r=this.currentTab,a=null;r&&(t.orderStateList=[r]),this.inFilter&&(delete(a=o()({},this.filterForm)).dateRange,t=i()({},t,a)),this.$http.post("/repair/order/list",o()({},t)).then(function(r){if(0===r.data.code){var a=r.data.data;e.lists=a.list,e.pageSize=a.pageSize,e.totalCount=a.totalCount,t.orderStateList||(e.orderNav[0].count=a.totalCount)}else console.log("工单列表获取失败："+r.data.msg);e.filter=!1})},filterDateChange:function(e){this.filterForm.createTimeStart=e[0],this.filterForm.createTimeEnd=e[1]},clearFilter:function(){this.filterForm={},this.filter=!1,this.inFilter=!1,this.getLists()},sureFilter:function(){delete o()({},this.filterForm).dateRange,this.inFilter=!0,this.getLists()},pageChange:function(e){this.pageNo=e,this.getLists()},pageSizeChange:function(e){this.pageSize=e,this.getLists()},getStateCount:function(){var e=this;this.$http.get("/repair/order/state/count").then(function(t){if(0===t.data.code){var r=t.data.data;e.orderNav=e.orderNav.map(function(e){for(var t=0;t<r.length;t++){var a=r[t].state;if(e.state===a){var i=parseInt(r[t].countNum);e.count=i}}return e})}else console.log("/repair/order/state/count:"+t.data.msg)})}},mounted:function(){var e=this;this.getLists(),this.getStateCount(),n.a.getRepairType(function(t){e.repairLists=t})},watch:{currentTab:function(e){this.pageNo=1,this.pageSize=10,this.totalCount=0,this.inFilter=!1,this.getLists()}}},c={render:function(){var e=this,t=e.$createElement,r=e._self._c||t;return r("Card",[r("ul",{staticClass:"tab-nav mb-15"},e._l(e.orderNav,function(t,a){return r("li",{key:t.title,class:t.check?"nav-active":"",on:{click:function(t){e.toggleTab(a)}}},[r("Badge",{attrs:{count:t.count,"overflow-count":99}},[r("span",{staticClass:"nav-title"},[e._v(e._s(t.title))])])],1)})),e._v(" "),r("div",{staticClass:"tab-content"},[r("div",{staticClass:"clearfix mb-15"},[r("div",{staticClass:"pull-left"},[r("Button",{attrs:{type:"primary"},on:{click:function(t){e.showModal=!0}}},[e._v("新建")]),e._v(" "),r("Button",{on:{click:function(t){e.filter=!0}}},[e._v("筛选")])],1),e._v(" "),r("div",{staticClass:"pull-right"},[r("Button",{attrs:{type:"primary"},on:{click:e.downloadExcel}},[e._v("excel导出")])],1)]),e._v(" "),r("div",{staticClass:"tabler-wrapper"},[r("Table",{attrs:{columns:e.columns,data:e.lists}}),e._v(" "),r("div",{staticClass:"pagination"},[r("Page",{attrs:{total:e.totalCount,"show-sizer":"","show-elevator":""},on:{"on-change":e.pageChange,"on-page-size-change":e.pageSizeChange}})],1)],1)]),e._v(" "),r("create-order",{attrs:{createOrder:e.showModal},on:{close:e.closeModal}}),e._v(" "),r("Drawer",{attrs:{width:"425",title:"工单筛选"},on:{"on-close":e.clearFilter},model:{value:e.filter,callback:function(t){e.filter=t},expression:"filter"}},[r("div",{staticClass:"clearfix mb-15"},[r("div",{staticClass:"pull-left"},[r("Button",{on:{click:e.clearFilter}},[e._v("清空筛选条件")])],1),e._v(" "),r("div",{staticClass:"pull-right"},[r("Button",{attrs:{type:"primary"},on:{click:e.sureFilter}},[e._v("确定筛选")])],1)]),e._v(" "),r("Form",{attrs:{model:e.filterForm,refs:"filterForm"}},[r("FormItem",{attrs:{label:"报修类型"}},[r("Select",{model:{value:e.filterForm.repairCategoryId,callback:function(t){e.$set(e.filterForm,"repairCategoryId",t)},expression:"filterForm.repairCategoryId"}},e._l(e.repairLists,function(t){return r("Option",{key:t.id,attrs:{value:t.id}},[e._v(e._s(t.name))])}))],1),e._v(" "),r("FormItem",{attrs:{label:"工单编号"}},[r("Input",{model:{value:e.filterForm.orderSn,callback:function(t){e.$set(e.filterForm,"orderSn",t)},expression:"filterForm.orderSn"}})],1),e._v(" "),r("FormItem",{attrs:{label:"服务人员"}},[r("Input",{model:{value:e.filterForm.serviceUserName,callback:function(t){e.$set(e.filterForm,"serviceUserName",t)},expression:"filterForm.serviceUserName"}})],1),e._v(" "),r("FormItem",{attrs:{label:"联系电话"}},[r("Input",{attrs:{number:!0,maxlength:11},on:{"on-blur":function(t){e.validateTel(e.filterForm.userPhone)}},model:{value:e.filterForm.userPhone,callback:function(t){e.$set(e.filterForm,"userPhone",t)},expression:"filterForm.userPhone"}}),e._v(" "),e.telValid?e._e():r("span",{staticClass:"text-red"},[e._v("请输入正确格式的手机号")])],1),e._v(" "),r("FormItem",{attrs:{label:"工单状态"}},[r("div",{staticStyle:{clear:"both"}},[r("CheckboxGroup",{model:{value:e.filterForm.orderStateList,callback:function(t){e.$set(e.filterForm,"orderStateList",t)},expression:"filterForm.orderStateList"}},e._l(e.orderNav,function(t){return t.state?r("Checkbox",{key:t.state,attrs:{label:t.state}},[e._v(e._s(t.title))]):e._e()}))],1)]),e._v(" "),r("FormItem",{attrs:{label:"是否上传证据"}},[r("i-switch",{attrs:{"true-value":"Y","false-value":"N"},model:{value:e.filterForm.hasEvidence,callback:function(t){e.$set(e.filterForm,"hasEvidence",t)},expression:"filterForm.hasEvidence"}},[r("span",{attrs:{slot:"open"},slot:"open"},[e._v("是")]),e._v(" "),r("span",{attrs:{slot:"close"},slot:"close"},[e._v("否")])])],1),e._v(" "),r("FormItem",{attrs:{label:"是否有回访记录"}},[r("i-switch",{attrs:{"true-value":"Y","false-value":"N"},model:{value:e.filterForm.hasReturnVisit,callback:function(t){e.$set(e.filterForm,"hasReturnVisit",t)},expression:"filterForm.hasReturnVisit"}},[r("span",{attrs:{slot:"open"},slot:"open"},[e._v("是")]),e._v(" "),r("span",{attrs:{slot:"close"},slot:"close"},[e._v("否")])])],1),e._v(" "),r("FormItem",{attrs:{label:"质保中"}},[r("i-switch",{attrs:{"true-value":"Y","false-value":"N"},model:{value:e.filterForm.isWarranty,callback:function(t){e.$set(e.filterForm,"isWarranty",t)},expression:"filterForm.isWarranty"}},[r("span",{attrs:{slot:"open"},slot:"open"},[e._v("是")]),e._v(" "),r("span",{attrs:{slot:"close"},slot:"close"},[e._v("否")])])],1),e._v(" "),r("FormItem",{attrs:{label:"售后记录"}},[r("i-switch",{attrs:{"true-value":"Y","false-value":"N"},model:{value:e.filterForm.afterSaleRecord,callback:function(t){e.$set(e.filterForm,"afterSaleRecord",t)},expression:"filterForm.afterSaleRecord"}},[r("span",{attrs:{slot:"open"},slot:"open"},[e._v("是")]),e._v(" "),r("span",{attrs:{slot:"close"},slot:"close"},[e._v("否")])])],1),e._v(" "),r("FormItem",{attrs:{label:"渠道来源"}},[r("Select",{model:{value:e.filterForm.orderSource,callback:function(t){e.$set(e.filterForm,"orderSource",t)},expression:"filterForm.orderSource"}},[r("Option",{attrs:{value:"APP"}},[e._v("APP")]),e._v(" "),r("Option",{attrs:{value:"CALL_CENTER"}},[e._v("呼叫中心")]),e._v(" "),r("Option",{attrs:{value:"STATION"}},[e._v("服务网点")])],1)],1),e._v(" "),r("FormItem",{attrs:{label:"创建时间"}},[r("DatePicker",{staticStyle:{width:"100%"},attrs:{type:"daterange"},on:{"on-change":e.filterDateChange},model:{value:e.filterForm.dateRange,callback:function(t){e.$set(e.filterForm,"dateRange",t)},expression:"filterForm.dateRange"}})],1)],1)],1)],1)},staticRenderFns:[]};var d=r("VU/8")(l,c,!1,function(e){r("cREe")},"data-v-52751c08",null);t.default=d.exports},cREe:function(e,t){},sUDz:function(e,t){},spv5:function(e,t,r){"use strict";var a=r("Dd8w"),i=r.n(a),s=r("TVG1"),o={name:"createOrder",data:function(){return{loadingSubmit:!1,loadingSearch:!1,acceptFee:!1,searchTelRes:[],newOrder:{repairRegionId:"",repairCategoryId:"",userPhone:"",ysyUserPhone:"",repairAddress:""},newOrderRule:{repairAddress:[{required:!0,message:"请输入报修地址",trigger:"blur"}],repairCategoryId:[{required:!0,message:"请选择报修分类",trigger:"change"}],repairRegionId:[{required:!0,message:"请选择报修区域",trigger:"change"}],userPhone:[{required:!0,message:"请输入联系电话",trigger:"blur"},{validator:function(e,t,r){/^1[3456789]\d{9}$/.test(t)||t.length<=0?r():r(new Error("请输入正确格式的手机号码"))},trigger:"blur"}]},ysyTelSearch:!1,repairDisSearch:!1,repairLists:[],regionList:[],stationLists:[],ysyUserPhoneValid:!0}},props:{createOrder:Boolean},computed:{activeModal:{get:function(){return this.createOrder},set:function(e){this.$refs.newOrder.resetFields(),this.$emit("close","createModal")}}},methods:{setTel:function(e){if(e.length<=0)return this.ysyUserPhoneValid=!0,void(this.newOrder.ysyUserPhone="");/^1[3456789]\d{9}$/.test(e)?(this.ysyUserPhoneValid=!0,this.newOrder.ysyUserPhone=e):this.ysyUserPhoneValid=!1},searchThis:function(e){this[e+"Search"]=!0},sureSearch:function(e,t){this.newOrder[e]=t,this[e+"Search"]=!1},getRegionLists:function(){var e=this;this.$http.get("/repair/region/list").then(function(t){0===t.data.code?e.regionList=t.data.data:console.log("新建工单获取报修区域："+t.data.msg)})},sureSend:function(){var e=this;this.loadingSubmit=!0,this.$refs.newOrder.validate(function(t){if(t){var r=i()({},e.newOrder),a=e.newOrder.repairCategoryId.split("+");if(r.repairCategoryId=a[0],parseFloat(a[1])>0&&!e.acceptFee)return e.$Message.info("请先勾选接受上门费，再继续"),e.loadingSubmit=!1,!1;e.$http.post("/repair/order/add",i()({},r)).then(function(t){0===t.data.code?(e.$Message.success("保存成功"),e.activeModal=!1,e.newOrder={repairRegionId:"",repairCategoryId:"",userPhone:"",ysyUserPhone:"",repairAddress:""}):(e.$Message.error("保存失败："+t.data.msg),e.activeModal=!1),e.loadingSubmit=!1})}else e.loadingSubmit=!1})},searchTel:function(e){var t=this;""!==e?(this.loadingSearch=!0,this.$http.get("/repair/order/user/list?phone="+e).then(function(e){t.loadingSearch=!1,0===e.data.code&&(t.searchTelRes=e.data.data)})):this.searchTelRes=[]}},mounted:function(){var e=this;this.getRegionLists(),s.a.getRepairType(function(t){e.repairLists=t}),s.a.getStationLists(function(t){e.stationLists=t})}},n={render:function(){var e=this,t=e.$createElement,r=e._self._c||t;return r("div",[r("Modal",{attrs:{"mask-closable":!1,title:"新建工单"},model:{value:e.activeModal,callback:function(t){e.activeModal=t},expression:"activeModal"}},[r("div",{staticClass:"new_order_wrapper"},[r("Form",{ref:"newOrder",attrs:{model:e.newOrder,rules:e.newOrderRule,"label-position":"top"}},[r("FormItem",{attrs:{label:"一生约绑定手机（非必填）",prop:"ysyUserPhone"}},[r("Select",{attrs:{filterable:"",remote:"","remote-method":e.searchTel,loading:e.loadingSearch},on:{"on-query-change":e.setTel},model:{value:e.newOrder.ysyUserPhone,callback:function(t){e.$set(e.newOrder,"ysyUserPhone",t)},expression:"newOrder.ysyUserPhone"}},e._l(e.searchTelRes,function(t,a){return r("Option",{key:a,attrs:{value:t}},[e._v(e._s(t))])})),e._v(" "),e.ysyUserPhoneValid?e._e():r("span",{staticClass:"text-red"},[e._v("请填写正确的手机号")])],1),e._v(" "),r("FormItem",{attrs:{label:"联系电话",prop:"userPhone"}},[r("Input",{model:{value:e.newOrder.userPhone,callback:function(t){e.$set(e.newOrder,"userPhone",t)},expression:"newOrder.userPhone"}})],1),e._v(" "),r("FormItem",{attrs:{label:"报修分类",prop:"repairCategoryId"}},[r("Row",{attrs:{gutter:15}},[r("Col",{attrs:{span:"14"}},[r("Select",{model:{value:e.newOrder.repairCategoryId,callback:function(t){e.$set(e.newOrder,"repairCategoryId",t)},expression:"newOrder.repairCategoryId"}},e._l(e.repairLists,function(t){return r("Option",{key:t.id,attrs:{value:t.id+"+"+t.dtdServiceFee}},[e._v(e._s(t.name)+e._s(t.dtdServiceFee?"(上门费："+t.dtdServiceFee+")":""))])}))],1),e._v(" "),r("Col",{attrs:{span:"8"}},[r("Checkbox",{model:{value:e.acceptFee,callback:function(t){e.acceptFee=t},expression:"acceptFee"}},[e._v("接受上门费")])],1)],1)],1),e._v(" "),r("FormItem",{attrs:{label:"服务区域",prop:"repairRegionId"}},[r("Select",{model:{value:e.newOrder.repairRegionId,callback:function(t){e.$set(e.newOrder,"repairRegionId",t)},expression:"newOrder.repairRegionId"}},e._l(e.regionList,function(t){return r("Option",{key:t.id,attrs:{value:t.id}},[e._v(e._s(t.name))])}))],1),e._v(" "),r("FormItem",{attrs:{label:"详细地址",prop:"repairAddress"}},[r("Input",{model:{value:e.newOrder.repairAddress,callback:function(t){e.$set(e.newOrder,"repairAddress",t)},expression:"newOrder.repairAddress"}})],1)],1)],1),e._v(" "),r("div",{attrs:{slot:"footer"},slot:"footer"},[r("Button",{on:{click:function(t){e.activeModal=!1}}},[e._v("取消")]),e._v(" "),r("Button",{attrs:{loading:e.loadingSubmit,type:"primary"},on:{click:e.sureSend}},[e._v("发送至服务网点")])],1)])],1)},staticRenderFns:[]};var l=r("VU/8")(o,n,!1,function(e){r("sUDz")},"data-v-2825d4ea",null);t.a=l.exports}});